# Maskinporten testclient
This project is a testclient for Maskinporten. The testclient have three usages,
1. Create an access_token with a specific scope
2. Administrate Maskinporten scopes
3. Administrate Maskinporten users and crypto keys

To use this testclient you must first:
* Create a "virksomhetssertifikat" and put the private key and the certificate in a Java KeyStore or PKCS#12 file 
* Create a Maskinporten user with access to one or more of the following scope:
  1. idporten:dcr.[read|write] - For administration of users
  2. idporten:scopes.[read|write] - For administration of scopes
  3. [any] - Create an access_token for a specific API
* Create a <b>logs</b> directory for the logging output

### Client configuration
To use the testclient you need a property file holding your client configuration. This example contains reference to Digdir test environment.  

```
###########################
# Configuration of output #
###########################

#Print the decoded JWT in a readable format
prettyPrintJWT=[true|false]

#Print the result to file
saveResult=[true|false]

#Issue an example security token based on JWT from Maskinporten.
issueExampleToken=[true|false]

#Show information about the certificate linked to the private key used for signing.
showCertificateInfo=[true|false]

##########################################################################################
# There are two types of access token issued by Maskinporten:                            #
# 1. User access token which is used to access an API                                    #
# 2. Admin access token which is used to access administration API at Samarbeidsportalen #
##########################################################################################
#This value will be set in the audience claim in the access_token returned from Maskinporten
resource=https://www.vegvesen.no

#-------------------------------
# User Access Token # 
# token.endpoint: The url to the token endpoint for Maskinporten
# audience: The audience included in the JWT generated by this client.
# user: The client ID created at Samarbeidsportalen.
# scope: The scope the access token must contain.  The Client ID must be given access to the scope in Samarbeidsportalen.
#-------------------------------
# Uncomment to retrieve an access_token which can be used to access an company API
token.endpoint=https://ver2.maskinporten.no/token
audience=https://ver2.maskinporten.no/
accesstoken.user=<client id>
accesstoken.scope=<scope>

# Admin Access Token #
# token.endpoint.admin: The url to the token admin endpoint for Samarbeidsportalen
# audience: The audience included in the JWT generated by this client.
# admin.user: The client ID that have access to administration API . Note! This user must be created by Digdir.
# admin.scope: The scope the access token must contain. Note! Admin scopes can only be given by Digdir.
############
# Uncomment to generate av access token which can be used to access the administration API of Maskinporten.
token.endpoint.admin=https://oidc-ver2.difi.no/idporten-oidc-provider/token
audience.admin=https://oidc-ver2.difi.no/idporten-oidc-provider/
accesstoken.admin.user=<admin client id>
#accesstoken.admin.scope=idporten:scopes.read
#accesstoken.admin.scope=idporten:scopes.write
#accesstoken.admin.scope=idporten:dcr.read


###########################################
# Common configuration for administration #
###########################################
# Client id used to administrate Maskinporten. Client user must have access to the scope: idporten:scopes.read, idporten:scopes.write and idporten:dcr.read
admin.user=<admin client id>

#########################################
# Administration of Maskinporten scopes #
#########################################

# Uncomment to retrieve all scopes the company has access to.
scope.list=true
scope.list.endpoint=https://integrasjon-ver2.difi.no/scopes

# Uncomment to retrieve all companies who have access to a given scope.
scope.access=true
scope.access.endpoint=https://integrasjon-ver2.difi.no/scopes/access?scope=
scope.access.id=<scope>

# Uncomment to add an organization access to a given scope.
scope.add=true
scope.add.endpoint=https://integrasjon-ver2.difi.no/scopes2/access/
scope.add.id=<scope>
scope.add.orgnr=<organization number>

# Uncomment to remove an organization access to a given scope.
scope.delete=true
scope.delete.endpoint=https://integrasjon-ver2.difi.no/scopes/access/
scope.delete.id=<scope>
scope.delete.orgnr=<organization number>


#################################
# Administration of certificate #
#################################
# Uncomment to retrieve all public certificates registered to the provided client.
# The provided user must have access to the scope: idporten:dcr.read
certificate.endpoint=https://integrasjon-ver2.difi.no/clients/oidc_svv_api/jwks
certificate.read.user=<admin client id>


##################################################
# Administration of "Samarbeidsportalen" clients #
##################################################
# Uncomment to retrieve all clients the company has access to.
# The provided user must have access to the scope: idporten:dcr.read
clients.endpoint=https://integrasjon-ver2.difi.no/clients
client.read.user=<admin client id>


############################
# Keypair used for signing #
############################

keystore.file=<path to your keystore file holding your virksomhetssertifikat / keypair>
keystore.password=<keystore password>
keystore.alias=<alias for your virksomhetssertifikat's key>
keystore.alias.password=<alias password>

```

## Usage

To build and run use:

```
mvn package

java -jar target\maskinporten-1.0-SNAPSHOT.jar <property file name>

```

